import AsyncStorage from "@react-native-async-storage/async-storage";
import React, {
  createContext,
  useCallback,
  useContext,
  useEffect,
  useMemo,
  useState,
} from "react";

export type SupportedLocale = "fr" | "en" | "es" | "de" | "it" | "pt" | "nl";

const STORAGE_KEY = "@reptitrack_locale";
const FALLBACK_LOCALE: SupportedLocale = "fr";

export const LANGUAGE_LABELS: Record<SupportedLocale, string> = {
  fr: "Français",
  en: "English",
  es: "Español",
  de: "Deutsch",
  it: "Italiano",
  pt: "Português",
  nl: "Nederlands",
};

export const LANGUAGE_ORDER: SupportedLocale[] = ["fr", "en"];

type TranslationValue =
  | string
  | ((params?: Record<string, string | number>) => string);

const translations: Record<SupportedLocale, Record<string, TranslationValue>> = {
  fr: {
    "reptiles.title": "Mes reptiles",
    "reptiles.subtitle": "Retrouvez l'ensemble de vos reptiles et leurs détails.",
    "reptiles.search": "Rechercher un reptile",
    "reptiles.unknown_species": "Espèce inconnue",
    "reptiles.age_suffix": "ans",
    "reptiles.view_more": "Voir plus",
    "reptiles.delete_title": "Suppression",
    "reptiles.delete_confirm": "Êtes-vous sûr de vouloir supprimer ce reptile ?",
    "reptiles.delete_action": "Supprimer",
    "reptiles.delete_success": "Reptile supprimé avec succès !",
    "reptiles.delete_error": "Une erreur est survenue, veuillez réessayer.",
    "feed.title": "Stock alimentaire",
    "feed.subtitle": "Ajustez rapidement les quantités et suivez l'historique.",
    "feed.actions": "Actions rapides",
    "feed.forecast": "Prévision stock (30 jours)",
    "feed.history": "Historique",
    "feed.history_subtitle": "Toutes les variations de stock en un coup d'œil.",
    "feed.unit_default": "pcs",
    "common.date_unavailable": "Date non disponible",
    "feed.history_chip": "Historique des stocks",
    "feed.items": "Articles",
    "feed.low_stock": "Faible stock",
    "feed.no_forecast": "Pas assez de données de consommation pour prévoir.",
    "feed.stock_label": "Stock",
    "feed.daily_consumption": "Conso/j",
    "feed.days_short": "j",
    "feed.days_more_than": ({ count }) => `>${count} j`,
    "feed.toast_update_success": "Stock mis à jour avec succès",
    "feed.toast_update_error": "Une erreur s'est produite",
    "feed.toast_delete_success": "Aliment supprimé",
    "feed.toast_delete_error": "Impossible de supprimer cet aliment",
    "feed.remaining": "restant(s)",
    "feed.default_type": "Nourriture",
    "common.add": "Ajouter",
    "common.remove": "Retirer",
    "common.delete": "Supprimer",
    "common.cancel": "Annuler",
    "common.view_all": "Voir tous",
    "common.confirm": "Confirmer",
    "common.save": "Enregistrer",
    "common.ok": "OK",
    "common.error": "Erreur",
    "common.clear": "Effacer",
    "common.health": "Santé",
    "common.last_feed": "Dernier repas",
    "common.retry": "Réessayer",
    "error.title": "Une erreur est survenue",
    "error.body":
      "Nous sommes désolés pour le désagrément. Notre équipe y travaille.",
    "home.welcome": "Bonjour !",
    "home.subtitle": "Bienvenue sur votre tableau de bord.",
    "home.reptiles": "Reptiles",
    "home.events": "Événements du jour",
    "home.notifications": "Notifications non lues",
    "home.alerts": "Alertes santé",
    "home.logout_title": "Déconnexion",
    "home.logout_confirm": "Se déconnecter ?",
    "home.logout_action": "Déconnexion",
    "home.shortcuts": "Raccourcis",
    "home.add_reptile": "Ajouter un reptile",
    "home.new_event": "Nouvel événement",
    "home.add_stock": "Ajouter un stock",
    "home.today": "Aujourd'hui",
    "home.summary_subtitle": "Vos indicateurs clés en un coup d'œil.",
    "home.summary_error": "Dashboard indisponible.",
    "home.upcoming_events": "Prochains événements",
    "home.upcoming_empty": "Aucun événement prévu pour le moment.",
    "home.reptiles_count": ({ count }) => `${count} reptiles enregistrés.`,
    "home.useful_links": "Liens utiles",
    "home.useful_links_subtitle": "Identification et ressources fiables.",
    "home.link_inpn_desc": "Fiches officielles des espèces en France",
    "home.link_shf_desc": "Ressources et actions pour l'herpétofaune",
    "home.link_sos_desc": "Aide et identification en France",
    "home.link_reptile_db_desc": "Base taxonomique mondiale des reptiles",
    "home.link_inaturalist_desc": "Identification communautaire via photos",
    "nav.home": "Accueil",
    "nav.reptiles": "Reptiles",
    "nav.feed": "Aliments",
    "nav.agenda": "Agenda",
    "nav.notifications": "Notifications",
    "nav.settings": "Paramètres",
    "nav.add_reptile": "Ajouter un reptile",
    "nav.add_measurements": "Ajouter des mesures",
    "nav.add_feed": "Ajouter des aliments",
    "nav.feed_history": "Historique des stocks",
    "nav.reptile_details": "Détails du reptile",
    "common.not_available": "—",
    "common.close": "Fermer",
    "common.download": "Télécharger",
    "common.refresh": "Actualiser",
    "empty_list.title": "Aucun résultat",
    "empty_list.subtitle": "Ajoutez un premier élément pour commencer.",
    "profile.update_error": "Erreur lors de la mise à jour",
    "profile.report_title": "Rapport d'élevage",
    "profile.report_recent": "Derniers suivis",
    "profile.report_species": "Espèce",
    "profile.report_sex": "Sexe",
    "profile.report_age": "Âge",
    "profile.report_morph": "Morph",
    "profile.report_mutations": "Mutations",
    "profile.report_lineage": "Lignée",
    "profile.report_last_feed": "Dernier repas",
    "profile.report_last_shed": "Dernière mue",
    "profile.report_last_measure": "Dernière mesure",
    "profile.trends_title": "Tendances",
    "profile.trends_weight": "Poids",
    "profile.trends_size": "Taille",
    "profile.trends_period": "30 derniers jours (ou historique complet)",
    "profile.trends_alert": "Variation importante détectée. Vérifiez l'état de santé.",
    "profile.trends_empty": "Ajoutez au moins 2 mesures pour voir une tendance.",
    "profile.genetics_saved": "Génétique enregistrée",
    "profile.genetics_error": "Erreur lors de l'enregistrement",
    "profile.section_profile": "Profil & habitat",
    "profile.section_feeding": "Alimentation",
    "profile.section_health": "Santé",
    "profile.section_actions": "Actions",
    "profile.actions_save": "Modifier les informations",
    "profile.field_age": "Âge",
    "profile.field_species": "Espèce",
    "profile.field_acquired": "Date d'acquisition",
    "profile.field_origin": "Origine",
    "profile.field_location": "Emplacement",
    "profile.field_humidity": "Humidité",
    "profile.field_temperature": "Température",
    "profile.field_last_fed": "Dernier repas",
    "profile.field_diet": "Régime alimentaire",
    "profile.field_health": "État de santé",
    "profile.notes_title": "Notes & observations",
    "profile.notes_placeholder": "Informations",
    "profile.notes_save": "Enregistrer les notes",
    "profile.sensor_title": "Capteur Govee",
    "profile.sensor_api_key": "Clé API Govee",
    "profile.sensor_save_key": "Enregistrer la clé",
    "profile.sensor_list_devices": "Lister mes capteurs",
    "profile.sensor_last_reading": "Dernière lecture",
    "profile.sensor_battery": "Batterie",
    "profile.sensor_no_data": "Aucune donnée. Lance \"Actualiser\".",
    "profile.sensor_select_device": "Sélectionnez un capteur pour voir les mesures.",
    "profile.photo_title": "Photo",
    "profile.photo_delete_confirm": "Supprimer cette photo ?",
    "profile.photo_share_title": ({ name }) => `Partager ${name}`,
    "profile.shed_add_title": "Ajouter une mue",
    "profile.shed_date": "Date de mue",
    "profile.shed_notes": "Notes",
    "profile.shed_delete_confirm": "Supprimer cette mue ?",
    "profile.shed_date_required": "Veuillez choisir une date",
    "profile.shed_added": "Mue ajoutée",
    "profile.shed_add_error": "Erreur lors de l'ajout",
    "profile.export_web_only":
      "L'export PDF est disponible sur iOS/Android (build dev/release).",
    "profile.export_no_data":
      "Impossible d'exporter : données du reptile indisponibles.",
    "profile.export_no_share":
      "PDF généré, mais le partage n'est pas disponible sur cet appareil.",
    "profile.export_missing_print":
      "expo-print n'est pas installé. Ajoute-le (expo install expo-print) puis rebuild.",
    "profile.export_failed": "Export PDF impossible. Réessaie après redémarrage.",
    "profile.photo_add_error": "Impossible d'ajouter la photo",
    "profile.photo_delete_success": "Photo supprimée",
    "profile.photo_delete_error": "Erreur lors de la suppression",
    "profile.photo_download_error": "Impossible de télécharger l'image",
    "profile.photo_share_unavailable": "Partage non disponible sur cet appareil",
    "profile.photo_share_error": "Impossible de partager cette photo",
    "profile.govee_key_saved": "Clé Govee enregistrée",
    "profile.govee_key_error": "Impossible d'enregistrer la clé",
    "profile.feeding_delete_success": "Nourrissage supprimé",
    "profile.feeding_delete_error": "Erreur lors de la suppression",
    "profile.feeding_delete_confirm": "Supprimer ce nourrissage ?",
    "profile.shed_delete_success": "Mue supprimée",
    "profile.shed_delete_error": "Erreur lors de la suppression",
    "profile.notes_saved": "Notes enregistrées",
    "profile.info_updated": "Informations mises à jour",
    "profile.report_reptile": "Reptile",
    "profile.report_location": "Localisation",
    "profile.report_acquired": "Acquisition",
    "profile.report_last_meal": "Dernier repas",
    "profile.report_diet": "Régime",
    "profile.report_temp_humidity": "Température / Humidité",
    "profile.report_notes": "Notes",
    "profile.report_no_notes": "Aucune note",
    "profile.food_summary_last": "Dernier repas",
    "profile.food_summary_diet": "Régime",
    "profile.health_unknown": "État non renseigné",
    "quick_actions.title": "Actions rapides",
    "quick_actions.add_feed": "Ajouter un repas",
    "quick_actions.add_measure": "Mesure",
    "quick_actions.add_event": "Événement",
    "quick_actions.export_pdf": "Export PDF",
    "feed_portal.title": "Choisir un aliment",
    "feed_portal.select_required": "Veuillez sélectionner au moins un aliment.",
    "feed_portal.feed_saved": "Nourrissage enregistré",
    "feed_portal.feed_error": "Erreur lors de l'enregistrement du nourrissage",
    "feed_portal.note_for": ({ name }) => `Nourrissage de ${name}`,
    "gallery.title": "Galerie",
    "gallery.add": "Ajouter",
    "gallery.empty": "Ajoutez des photos pour garder l'historique.",
    "history.feed_title": "Historique repas",
    "history.feed_desc": "5 derniers",
    "history.feed_default": "Repas",
    "history.feed_empty": "Aucun repas enregistré.",
    "history.shed_title": "Historique des mues",
    "history.shed_desc": "5 dernières",
    "history.shed_add": "Ajouter une mue",
    "history.shed_item": "Mue enregistrée",
    "history.shed_empty": "Aucune mue enregistrée.",
    "history.load_more": "Voir plus",
    "genetics.title": "Génétique",
    "genetics.save": "Enregistrer",
    "genetics.field.morph": "Morph",
    "genetics.field.mutations": "Mutations (ex: Albinos, Hypo)",
    "genetics.field.hets": "Hets (ex: 50% het albinos)",
    "genetics.field.traits": "Traits (couleurs, motifs)",
    "genetics.field.lineage": "Lignée",
    "genetics.field.breeder": "Éleveur",
    "genetics.field.hatch_date": "Date d'éclosion (YYYY-MM-DD)",
    "genetics.field.sire_name": "Nom du père",
    "genetics.field.dam_name": "Nom de la mère",
    "genetics.field.notes": "Notes génétiques",
    "alert_card.title": "Alertes santé",
    "health_alerts.no_feed": ({ count }) => `Aucun repas depuis ${count} jours`,
    "health_alerts.no_shed": ({ count }) => `Aucune mue depuis ${count} jours`,
    "health_alerts.weight_drop": ({ count }) =>
      `Perte de poids ${count}% depuis la première mesure`,
    "event_modal.title": "Ajouter un événement",
    "event_modal.placeholder": "Description de l'événement",
    "chart.temperature": "Température",
    "chart.humidity": "Humidité",
    "chart.weight_title": "Poids du reptile",
    "chart.weight_empty": "Pas encore de mesures de poids.",
    "chart.size_title": "Taille du reptile",
    "chart.size_empty": "Pas encore de mesures de taille.",
    "add_reptile.title": "Nouveau reptile",
    "add_reptile.subtitle": "Ajoutez un compagnon et commencez le suivi.",
    "add_reptile.photo_hint": "Appuyez pour ajouter une photo.",
    "add_reptile.image_error": "Impossible de sélectionner l'image.",
    "add_reptile.success": "Reptile ajouté avec succès !",
    "add_reptile.error": "Une erreur est survenue, veuillez réessayer.",
    "add_reptile.section.identity": "Identité",
    "add_reptile.section.origin": "Origine",
    "add_reptile.section.feeding": "Alimentation",
    "add_reptile.section.health_env": "Santé & environnement",
    "add_reptile.name": "Nom",
    "add_reptile.species": "Espèce",
    "add_reptile.age": "Âge",
    "add_reptile.snake": "Serpent",
    "add_reptile.lizard": "Lézard",
    "add_reptile.female": "Femelle",
    "add_reptile.male": "Mâle",
    "add_reptile.origin": "Origine",
    "add_reptile.location": "Emplacement",
    "add_reptile.acquired_date": "Acquisition",
    "add_reptile.diet": "Régime alimentaire",
    "add_reptile.feeding_schedule": "Fréquence de repas",
    "add_reptile.health_status": "État de santé",
    "add_reptile.last_fed": "Dernier repas",
    "add_reptile.humidity": "Niveau d'humidité",
    "add_reptile.temperature": "Plage de température",
    "add_reptile.submit": "Ajouter",
    "settings.title": "Paramètres",
    "settings.language": "Langue de l'application",
    "settings.about": "À propos",
    "settings.help": "Aide / Support",
    "settings.pricing": "Tarifs",
    "settings.help_desc": "FAQ / Support",
    "settings.pricing_desc": "Plans et fonctionnalités",
    "settings.pricing_monthly": "Abonnement mensuel",
    "settings.pricing_monthly_price": "1,99€ / mois",
    "settings.pricing_monthly_desc": "Plus de 1 reptile",
    "settings.pricing_yearly": "Abonnement annuel",
    "settings.pricing_yearly_price": "14,99€ / an",
    "settings.pricing_yearly_desc": "Plus de 1 reptile",
    "settings.support_faq": "FAQ",
    "settings.support_faq_desc": "Réponses aux questions fréquentes.",
    "settings.support_contact": "Contact",
    "settings.support_contact_desc":
      "Écrivez nous pour toutes questions ou ajout de fonctionnalités.",
    "settings.faq.title": "FAQ",
    "settings.faq.q1": "Où sont stockées mes données ?",
    "settings.faq.a1":
      "Les données sont stockées localement sur votre appareil. Aucune synchronisation multi‑appareils n'est activée pour l'instant.",
    "settings.faq.q2": "Puis-je utiliser l'app sans connexion ?",
    "settings.faq.a2":
      "Oui. L'app fonctionne hors ligne pour le suivi des reptiles, événements, mesures et stocks.",
    "settings.faq.q3": "Pourquoi Apple Sign In ?",
    "settings.faq.a3":
      "Cela évite la gestion des mots de passe et renforce la sécurité.",
    "settings.faq.q4": "Comment activer les notifications ?",
    "settings.faq.a4":
      "Autorisez les notifications dans les réglages iOS pour ReptiTrack.",
    "settings.faq.q5": "Comment exporter une fiche PDF ?",
    "settings.faq.a5":
      "Ouvrez la fiche reptile puis utilisez l'action “Export PDF”. Disponible sur iOS/Android (build dev ou release).",
    "settings.faq.q6": "Comment connecter un capteur Govee ?",
    "settings.faq.a6":
      "Ajoutez votre clé API Govee, listez vos capteurs, puis sélectionnez celui du terrarium.",
    "settings.faq.q7": "À quoi sert l'abonnement ?",
    "settings.faq.a7":
      "L'abonnement permet d'avoir plus d'un reptile. Les tarifs sont indiqués dans l'écran Tarifs.",
    "add_feed.title": "Ajouter un aliment",
    "add_feed.subtitle": "Gardez votre stock à jour pour chaque type de proie.",
    "add_feed.select_food": "Sélectionner une nourriture",
    "add_feed.choose_food": "Choisir un aliment",
    "add_feed.select_type": "Sélectionner le type",
    "add_feed.choose_type": "Choisir un type",
    "add_feed.quantity": "Quantité",
    "add_feed.add": "Ajouter",
    "add_feed.success": "Nourriture ajoutée avec succès",
    "add_feed.error": "Une erreur s'est produite",
    "add_feed.validation.name_required": "Nom de la nourriture requis",
    "add_feed.validation.qty_number": "La quantité doit être un nombre",
    "add_feed.validation.qty_required": "Quantité requise",
    "add_feed.validation.qty_min": "La quantité doit être au moins de 1",
    "food.chick": "Poussin",
    "food.chicken": "Poule",
    "food.quail": "Caille",
    "food.duck": "Canard",
    "food.turkey": "Dinde",
    "food.mouse": "Souris",
    "food.rat": "Rat",
    "food.lizard": "Lézard",
    "food.cricket": "Criquet",
    "food.roach": "Blatte",
    "food.mealworm": "Vers de farine",
    "food.earthworm": "Vers de terre",
    "food.grillon": "Grillon",
    "food.cockroach": "Cafard",
    "food.fish": "Poisson",
    "food.other": "Autre",
    "food_type.rodent": "Rongeur",
    "food_type.insects": "Insectes",
    "food_type.poultry": "Volaille",
    "food_type.fish": "Poisson",
    "food_type.reptile": "Reptile",
    "food_type.other": "Autre",
    "agenda.title": "Agenda",
    "agenda.subtitle": "Organisez les événements et rappels de soins.",
    "agenda.date_required": "La date est obligatoire.",
    "agenda.add_success": "Événement ajouté avec succès !",
    "agenda.add_error": "Une erreur est survenue, veuillez réessayer.",
    "agenda.update_success": "Événement mis à jour",
    "agenda.update_error": "Impossible de modifier l'événement",
    "agenda.delete_event_success": "Événement supprimé",
    "agenda.delete_event_error": "Impossible de supprimer l'événement",
    "agenda.delete_occurrence_success": "Occurrence supprimée",
    "agenda.delete_occurrence_error": "Impossible de supprimer l'occurrence",
    "agenda.delete_series_success": "Série supprimée",
    "agenda.delete_series_error": "Impossible de supprimer la série",
    "agenda.new_event_title": "Nouvel événement",
    "agenda.edit_event_title": "Modifier l'événement",
    "agenda.title_placeholder": "Titre",
    "agenda.reptile_optional": "Associer un reptile (optionnel)",
    "agenda.choose_reptile": "Choisir un reptile",
    "agenda.no_reptile": "Aucun reptile",
    "agenda.time": "Heure",
    "agenda.date": "Date",
    "agenda.notes": "Notes",
    "agenda.recurrence": "Récurrence",
    "agenda.recurrence_none": "Aucune",
    "agenda.recurrence_daily": "Quotidien",
    "agenda.recurrence_weekly": "Hebdo",
    "agenda.recurrence_monthly": "Mensuel",
    "agenda.recurrence_until": "Fin de récurrence (optionnel)",
    "agenda.edit_applies_series": "Cette modification s'applique à toute la série.",
    "agenda.save_event": "Enregistrer",
    "agenda.add_event": "Ajouter",
    "agenda.edit_event_button": "Modifier l'événement",
    "agenda.delete_occurrence": "Supprimer cette occurrence",
    "agenda.delete_series": "Supprimer toute la série",
    "agenda.delete_event": "Supprimer l'événement",
    "agenda.info_name": "Nom",
    "agenda.info_date": "Date",
    "agenda.info_time": "Heure",
    "agenda.info_reptile": "Reptile",
    "agenda.info_notes": "Notes",
    "agenda.info_recurrence": "Récurrence",
    "agenda.notification_title": "Rappel",
    "agenda.notification_event": "Événement",
    "add_measurements.title": "Ajouter des mesures",
    "add_measurements.subtitle": "Enregistrez poids et taille pour suivre l'évolution.",
    "add_measurements.weight": "Poids",
    "add_measurements.size": "Taille",
    "add_measurements.date": "Date",
    "add_measurements.add": "Ajouter",
    "add_measurements.success": "Mesures ajoutées avec succès !",
    "add_measurements.error": "Une erreur s'est produite",
    "auth.app_subtitle": "Suivi complet de vos reptiles, même hors ligne.",
    "auth.title": "Connexion",
    "auth.subtitle": "Utilise Apple pour une connexion simple et sécurisée.",
    "auth.success": "Connexion réussie",
    "auth.apple_refused": "Connexion Apple refusée",
    "auth.retry": "Réessayer",
    "auth.loading": "Connexion…",
    "auth.web_note": "Sur web, Apple Sign In requiert un environnement Apple (Safari). Teste surtout sur iOS.",
    "notifications.title": "Notifications",
    "notifications.subtitle": "Restez informé des rappels et événements importants.",
    "notifications.mark_all": "Tout lire",
    "notifications.unread": ({ count }) => `${count} non lues`,
    "notfound.title": "Page introuvable",
    "notfound.subtitle": "Cette page n'existe pas. Revenez à l'accueil.",
    "notfound.back": "Retour à l'accueil",
  },
  en: {
    "reptiles.title": "My reptiles",
    "reptiles.subtitle": "Find all your reptiles and their details.",
    "reptiles.search": "Search a reptile",
    "reptiles.unknown_species": "Unknown species",
    "reptiles.age_suffix": "years",
    "reptiles.view_more": "See details",
    "reptiles.delete_title": "Delete",
    "reptiles.delete_confirm": "Are you sure you want to delete this reptile?",
    "reptiles.delete_action": "Delete",
    "reptiles.delete_success": "Reptile deleted successfully!",
    "reptiles.delete_error": "An error occurred, please try again.",
    "feed.title": "Food stock",
    "feed.subtitle": "Quickly adjust quantities and follow history.",
    "feed.actions": "Quick actions",
    "feed.forecast": "Stock forecast (30 days)",
    "feed.history": "History",
    "feed.history_subtitle": "All stock changes at a glance.",
    "feed.unit_default": "pcs",
    "common.date_unavailable": "Date unavailable",
    "feed.history_chip": "Stock history",
    "feed.items": "Items",
    "feed.low_stock": "Low stock",
    "feed.no_forecast": "Not enough consumption data to forecast.",
    "feed.stock_label": "Stock",
    "feed.daily_consumption": "Daily use",
    "feed.days_short": "d",
    "feed.days_more_than": ({ count }) => `>${count} d`,
    "feed.toast_update_success": "Stock updated successfully",
    "feed.toast_update_error": "An error occurred",
    "feed.toast_delete_success": "Food deleted",
    "feed.toast_delete_error": "Unable to delete this food",
    "feed.remaining": "left",
    "feed.default_type": "Food",
    "common.add": "Add",
    "common.remove": "Remove",
    "common.delete": "Delete",
    "common.cancel": "Cancel",
    "common.view_all": "View all",
    "common.confirm": "Confirm",
    "common.save": "Save",
    "common.ok": "OK",
    "common.error": "Error",
    "common.clear": "Clear",
    "common.health": "Health",
    "common.last_feed": "Last feeding",
    "common.retry": "Retry",
    "error.title": "Something went wrong",
    "error.body": "Sorry for the inconvenience. Our team is working on it.",
    "home.welcome": "Hello!",
    "home.subtitle": "Welcome to your dashboard.",
    "home.reptiles": "Reptiles",
    "home.events": "Today's events",
    "home.notifications": "Unread notifications",
    "home.alerts": "Health alerts",
    "home.logout_title": "Sign out",
    "home.logout_confirm": "Sign out?",
    "home.logout_action": "Sign out",
    "home.shortcuts": "Shortcuts",
    "home.add_reptile": "Add reptile",
    "home.new_event": "New event",
    "home.add_stock": "Add stock",
    "home.today": "Today",
    "home.summary_subtitle": "Key indicators at a glance.",
    "home.summary_error": "Dashboard unavailable.",
    "home.upcoming_events": "Upcoming events",
    "home.upcoming_empty": "No upcoming events.",
    "home.reptiles_count": ({ count }) => `${count} reptiles registered.`,
    "home.useful_links": "Useful links",
    "home.useful_links_subtitle": "Identification and trusted resources.",
    "home.link_inpn_desc": "Official species records in France",
    "home.link_shf_desc": "Resources and actions for herpetofauna",
    "home.link_sos_desc": "Help and identification in France",
    "home.link_reptile_db_desc": "Global reptile taxonomy database",
    "home.link_inaturalist_desc": "Community identification via photos",
    "nav.home": "Home",
    "nav.reptiles": "Reptiles",
    "nav.feed": "Food",
    "nav.agenda": "Agenda",
    "nav.notifications": "Notifications",
    "nav.settings": "Settings",
    "nav.add_reptile": "Add reptile",
    "nav.add_measurements": "Add measurements",
    "nav.add_feed": "Add food",
    "nav.feed_history": "Stock history",
    "nav.reptile_details": "Reptile details",
    "common.not_available": "—",
    "common.close": "Close",
    "common.download": "Download",
    "common.refresh": "Refresh",
    "empty_list.title": "No results",
    "empty_list.subtitle": "Add your first item to get started.",
    "profile.update_error": "Update failed",
    "profile.report_title": "Breeding report",
    "profile.report_recent": "Latest tracking",
    "profile.report_species": "Species",
    "profile.report_sex": "Sex",
    "profile.report_age": "Age",
    "profile.report_morph": "Morph",
    "profile.report_mutations": "Mutations",
    "profile.report_lineage": "Lineage",
    "profile.report_last_feed": "Last feeding",
    "profile.report_last_shed": "Last shed",
    "profile.report_last_measure": "Last measurement",
    "profile.trends_title": "Trends",
    "profile.trends_weight": "Weight",
    "profile.trends_size": "Size",
    "profile.trends_period": "Last 30 days (or full history)",
    "profile.trends_alert": "Significant variation detected. Check health status.",
    "profile.trends_empty": "Add at least 2 measurements to see a trend.",
    "profile.genetics_saved": "Genetics saved",
    "profile.genetics_error": "Error while saving",
    "profile.section_profile": "Profile & habitat",
    "profile.section_feeding": "Feeding",
    "profile.section_health": "Health",
    "profile.section_actions": "Actions",
    "profile.actions_save": "Update information",
    "profile.field_age": "Age",
    "profile.field_species": "Species",
    "profile.field_acquired": "Acquired date",
    "profile.field_origin": "Origin",
    "profile.field_location": "Location",
    "profile.field_humidity": "Humidity",
    "profile.field_temperature": "Temperature",
    "profile.field_last_fed": "Last feeding",
    "profile.field_diet": "Diet",
    "profile.field_health": "Health status",
    "profile.notes_title": "Notes & observations",
    "profile.notes_placeholder": "Information",
    "profile.notes_save": "Save notes",
    "profile.sensor_title": "Govee sensor",
    "profile.sensor_api_key": "Govee API key",
    "profile.sensor_save_key": "Save key",
    "profile.sensor_list_devices": "List my sensors",
    "profile.sensor_last_reading": "Last reading",
    "profile.sensor_battery": "Battery",
    "profile.sensor_no_data": "No data. Tap \"Refresh\".",
    "profile.sensor_select_device": "Select a sensor to view readings.",
    "profile.photo_title": "Photo",
    "profile.photo_delete_confirm": "Delete this photo?",
    "profile.photo_share_title": ({ name }) => `Share ${name}`,
    "profile.shed_add_title": "Add shed",
    "profile.shed_date": "Shed date",
    "profile.shed_notes": "Notes",
    "profile.shed_delete_confirm": "Delete this shed?",
    "profile.shed_date_required": "Please choose a date",
    "profile.shed_added": "Shed added",
    "profile.shed_add_error": "Error while adding",
    "profile.export_web_only":
      "PDF export is available on iOS/Android (dev/release build).",
    "profile.export_no_data": "Unable to export: reptile data unavailable.",
    "profile.export_no_share":
      "PDF generated, but sharing is not available on this device.",
    "profile.export_missing_print":
      "expo-print is not installed. Add it (expo install expo-print) then rebuild.",
    "profile.export_failed": "PDF export failed. Try again after restart.",
    "profile.photo_add_error": "Unable to add the photo",
    "profile.photo_delete_success": "Photo deleted",
    "profile.photo_delete_error": "Delete failed",
    "profile.photo_download_error": "Unable to download the image",
    "profile.photo_share_unavailable": "Sharing is not available on this device",
    "profile.photo_share_error": "Unable to share this photo",
    "profile.govee_key_saved": "Govee key saved",
    "profile.govee_key_error": "Unable to save the key",
    "profile.feeding_delete_success": "Feeding deleted",
    "profile.feeding_delete_error": "Delete failed",
    "profile.feeding_delete_confirm": "Delete this feeding?",
    "profile.shed_delete_success": "Shed deleted",
    "profile.shed_delete_error": "Delete failed",
    "profile.notes_saved": "Notes saved",
    "profile.info_updated": "Information updated",
    "profile.report_reptile": "Reptile",
    "profile.report_location": "Location",
    "profile.report_acquired": "Acquired",
    "profile.report_last_meal": "Last feeding",
    "profile.report_diet": "Diet",
    "profile.report_temp_humidity": "Temperature / Humidity",
    "profile.report_notes": "Notes",
    "profile.report_no_notes": "No notes",
    "profile.food_summary_last": "Last feeding",
    "profile.food_summary_diet": "Diet",
    "profile.health_unknown": "Not provided",
    "quick_actions.title": "Quick actions",
    "quick_actions.add_feed": "Add feeding",
    "quick_actions.add_measure": "Measurement",
    "quick_actions.add_event": "Event",
    "quick_actions.export_pdf": "Export PDF",
    "feed_portal.title": "Choose food",
    "feed_portal.select_required": "Please select at least one food.",
    "feed_portal.feed_saved": "Feeding saved",
    "feed_portal.feed_error": "Unable to save feeding",
    "feed_portal.note_for": ({ name }) => `Feeding for ${name}`,
    "gallery.title": "Gallery",
    "gallery.add": "Add",
    "gallery.empty": "Add photos to keep history.",
    "history.feed_title": "Feeding history",
    "history.feed_desc": "Last 5",
    "history.feed_default": "Feeding",
    "history.feed_empty": "No feeding recorded.",
    "history.shed_title": "Shed history",
    "history.shed_desc": "Last 5",
    "history.shed_add": "Add shed",
    "history.shed_item": "Shed recorded",
    "history.shed_empty": "No shed recorded.",
    "history.load_more": "See more",
    "genetics.title": "Genetics",
    "genetics.save": "Save",
    "genetics.field.morph": "Morph",
    "genetics.field.mutations": "Mutations (e.g. Albino, Hypo)",
    "genetics.field.hets": "Hets (e.g. 50% het albino)",
    "genetics.field.traits": "Traits (colors, patterns)",
    "genetics.field.lineage": "Lineage",
    "genetics.field.breeder": "Breeder",
    "genetics.field.hatch_date": "Hatch date (YYYY-MM-DD)",
    "genetics.field.sire_name": "Sire name",
    "genetics.field.dam_name": "Dam name",
    "genetics.field.notes": "Genetics notes",
    "alert_card.title": "Health alerts",
    "health_alerts.no_feed": ({ count }) => `No feeding for ${count} days`,
    "health_alerts.no_shed": ({ count }) => `No shed for ${count} days`,
    "health_alerts.weight_drop": ({ count }) =>
      `Weight loss ${count}% since the first measurement`,
    "event_modal.title": "Add an event",
    "event_modal.placeholder": "Event description",
    "chart.temperature": "Temperature",
    "chart.humidity": "Humidity",
    "chart.weight_title": "Reptile weight",
    "chart.weight_empty": "No weight measurements yet.",
    "chart.size_title": "Reptile size",
    "chart.size_empty": "No size measurements yet.",
    "add_reptile.title": "New reptile",
    "add_reptile.subtitle": "Add a companion and start tracking.",
    "add_reptile.photo_hint": "Tap to add a photo.",
    "add_reptile.image_error": "Unable to select the image.",
    "add_reptile.success": "Reptile added successfully!",
    "add_reptile.error": "An error occurred, please try again.",
    "add_reptile.section.identity": "Identity",
    "add_reptile.section.origin": "Origin",
    "add_reptile.section.feeding": "Feeding",
    "add_reptile.section.health_env": "Health & environment",
    "add_reptile.name": "Name",
    "add_reptile.species": "Species",
    "add_reptile.age": "Age",
    "add_reptile.snake": "Snake",
    "add_reptile.lizard": "Lizard",
    "add_reptile.female": "Female",
    "add_reptile.male": "Male",
    "add_reptile.origin": "Origin",
    "add_reptile.location": "Location",
    "add_reptile.acquired_date": "Acquired",
    "add_reptile.diet": "Diet",
    "add_reptile.feeding_schedule": "Feeding schedule",
    "add_reptile.health_status": "Health status",
    "add_reptile.last_fed": "Last feeding",
    "add_reptile.humidity": "Humidity level",
    "add_reptile.temperature": "Temperature range",
    "add_reptile.submit": "Add",
    "settings.title": "Settings",
    "settings.language": "App language",
    "settings.about": "About",
    "settings.help": "Help / Support",
    "settings.pricing": "Pricing",
    "settings.help_desc": "FAQ / Support",
    "settings.pricing_desc": "Plans and features",
    "settings.pricing_monthly": "Monthly subscription",
    "settings.pricing_monthly_price": "€1.99 / month",
    "settings.pricing_monthly_desc": "More than 1 reptile",
    "settings.pricing_yearly": "Yearly subscription",
    "settings.pricing_yearly_price": "€14.99 / year",
    "settings.pricing_yearly_desc": "More than 1 reptile",
    "settings.support_faq": "FAQ",
    "settings.support_faq_desc": "Answers to common questions.",
    "settings.support_contact": "Contact",
    "settings.support_contact_desc": "Write to us for any question.",
    "settings.faq.title": "FAQ",
    "settings.faq.q1": "Where is my data stored?",
    "settings.faq.a1":
      "Data is stored locally on your device. Multi‑device sync is not enabled yet.",
    "settings.faq.q2": "Can I use the app offline?",
    "settings.faq.a2":
      "Yes. The app works offline for reptiles, events, measurements and stock.",
    "settings.faq.q3": "Why Apple Sign In?",
    "settings.faq.a3":
      "It avoids password management and improves security.",
    "settings.faq.q4": "How do I enable notifications?",
    "settings.faq.a4":
      "Allow notifications for ReptiTrack in iOS settings.",
    "settings.faq.q5": "How do I export a PDF?",
    "settings.faq.a5":
      "Open a reptile profile and use “Export PDF”. Available on iOS/Android (dev or release build).",
    "settings.faq.q6": "How do I connect a Govee sensor?",
    "settings.faq.a6":
      "Add your Govee API key, list your sensors, then select the terrarium sensor.",
    "settings.faq.q7": "What is the subscription for?",
    "settings.faq.a7":
      "The subscription allows more than one reptile. Pricing is listed in the Pricing screen.",
    "add_feed.title": "Add food",
    "add_feed.subtitle": "Keep your stock up to date for each prey type.",
    "add_feed.select_food": "Select food",
    "add_feed.choose_food": "Choose food",
    "add_feed.select_type": "Select type",
    "add_feed.choose_type": "Choose type",
    "add_feed.quantity": "Quantity",
    "add_feed.add": "Add",
    "add_feed.success": "Food added successfully",
    "add_feed.error": "An error occurred",
    "add_feed.validation.name_required": "Food name is required",
    "add_feed.validation.qty_number": "Quantity must be a number",
    "add_feed.validation.qty_required": "Quantity is required",
    "add_feed.validation.qty_min": "Quantity must be at least 1",
    "food.chick": "Chick",
    "food.chicken": "Chicken",
    "food.quail": "Quail",
    "food.duck": "Duck",
    "food.turkey": "Turkey",
    "food.mouse": "Mouse",
    "food.rat": "Rat",
    "food.lizard": "Lizard",
    "food.cricket": "Cricket",
    "food.roach": "Roach",
    "food.mealworm": "Mealworm",
    "food.earthworm": "Earthworm",
    "food.grillon": "Cricket",
    "food.cockroach": "Cockroach",
    "food.fish": "Fish",
    "food.other": "Other",
    "food_type.rodent": "Rodent",
    "food_type.insects": "Insects",
    "food_type.poultry": "Poultry",
    "food_type.fish": "Fish",
    "food_type.reptile": "Reptile",
    "food_type.other": "Other",
    "agenda.title": "Agenda",
    "agenda.subtitle": "Organize events and care reminders.",
    "agenda.date_required": "Date is required.",
    "agenda.add_success": "Event added successfully!",
    "agenda.add_error": "An error occurred, please try again.",
    "agenda.update_success": "Event updated",
    "agenda.update_error": "Unable to update the event",
    "agenda.delete_event_success": "Event deleted",
    "agenda.delete_event_error": "Unable to delete the event",
    "agenda.delete_occurrence_success": "Occurrence deleted",
    "agenda.delete_occurrence_error": "Unable to delete the occurrence",
    "agenda.delete_series_success": "Series deleted",
    "agenda.delete_series_error": "Unable to delete the series",
    "agenda.new_event_title": "New event",
    "agenda.edit_event_title": "Edit event",
    "agenda.title_placeholder": "Title",
    "agenda.reptile_optional": "Link a reptile (optional)",
    "agenda.choose_reptile": "Choose a reptile",
    "agenda.no_reptile": "No reptile",
    "agenda.time": "Time",
    "agenda.date": "Date",
    "agenda.notes": "Notes",
    "agenda.recurrence": "Recurrence",
    "agenda.recurrence_none": "None",
    "agenda.recurrence_daily": "Daily",
    "agenda.recurrence_weekly": "Weekly",
    "agenda.recurrence_monthly": "Monthly",
    "agenda.recurrence_until": "Recurrence end (optional)",
    "agenda.edit_applies_series": "This change applies to the entire series.",
    "agenda.save_event": "Save",
    "agenda.add_event": "Add",
    "agenda.edit_event_button": "Edit event",
    "agenda.delete_occurrence": "Delete this occurrence",
    "agenda.delete_series": "Delete entire series",
    "agenda.delete_event": "Delete event",
    "agenda.info_name": "Name",
    "agenda.info_date": "Date",
    "agenda.info_time": "Time",
    "agenda.info_reptile": "Reptile",
    "agenda.info_notes": "Notes",
    "agenda.info_recurrence": "Recurrence",
    "agenda.notification_title": "Reminder",
    "agenda.notification_event": "Event",
    "add_measurements.title": "Add measurements",
    "add_measurements.subtitle": "Record weight and size to track progress.",
    "add_measurements.weight": "Weight",
    "add_measurements.size": "Size",
    "add_measurements.date": "Date",
    "add_measurements.add": "Add",
    "add_measurements.success": "Measurements added successfully!",
    "add_measurements.error": "An error occurred",
    "auth.app_subtitle": "Complete reptile tracking, even offline.",
    "auth.title": "Sign in",
    "auth.subtitle": "Use Apple for a simple and secure sign-in.",
    "auth.success": "Signed in successfully",
    "auth.apple_refused": "Apple sign-in was refused",
    "auth.retry": "Try again",
    "auth.loading": "Signing in…",
    "auth.web_note": "On web, Apple Sign In requires an Apple environment (Safari). Test mainly on iOS.",
    "notifications.title": "Notifications",
    "notifications.subtitle": "Stay informed about reminders and important events.",
    "notifications.mark_all": "Mark all read",
    "notifications.unread": ({ count }) => `${count} unread`,
    "notfound.title": "Page not found",
    "notfound.subtitle": "This page doesn't exist. Return home.",
    "notfound.back": "Back to home",
  },
  es: {
    "reptiles.title": "Mis reptiles",
    "reptiles.subtitle": "Encuentra todos tus reptiles y sus detalles.",
    "reptiles.search": "Buscar un reptil",
    "feed.title": "Stock de alimentos",
    "feed.subtitle": "Ajusta rapidamente las cantidades y sigue el historial.",
    "feed.actions": "Acciones rapidas",
    "feed.forecast": "Prevision de stock (30 dias)",
    "feed.history": "Historial",
    "common.add": "Agregar",
    "common.remove": "Retirar",
    "common.delete": "Eliminar",
    "common.health": "Salud",
    "common.last_feed": "Ultima comida",
    "home.welcome": "Hola!",
    "home.subtitle": "Bienvenido a tu panel.",
    "home.reptiles": "Reptiles",
    "home.events": "Eventos de hoy",
    "home.notifications": "Notificaciones no leidas",
    "home.alerts": "Alertas de salud",
    "settings.title": "Ajustes",
    "settings.language": "Idioma de la app",
    "settings.about": "Acerca de",
    "settings.help": "Ayuda / Soporte",
    "settings.pricing": "Precios",
  },
  de: {
    "reptiles.title": "Meine Reptilien",
    "reptiles.subtitle": "Finde alle deine Reptilien und ihre Details.",
    "reptiles.search": "Reptil suchen",
    "feed.title": "Futterbestand",
    "feed.subtitle": "Passe Mengen schnell an und verfolge den Verlauf.",
    "feed.actions": "Schnellaktionen",
    "feed.forecast": "Bestandsprognose (30 Tage)",
    "feed.history": "Verlauf",
    "common.add": "Hinzufugen",
    "common.remove": "Entfernen",
    "common.delete": "Loschen",
    "common.health": "Gesundheit",
    "common.last_feed": "Letzte Futterung",
    "home.welcome": "Hallo!",
    "home.subtitle": "Willkommen auf deinem Dashboard.",
    "home.reptiles": "Reptilien",
    "home.events": "Heutige Ereignisse",
    "home.notifications": "Ungelesene Benachrichtigungen",
    "home.alerts": "Gesundheitswarnungen",
    "settings.title": "Einstellungen",
    "settings.language": "App-Sprache",
    "settings.about": "Uber",
    "settings.help": "Hilfe / Support",
    "settings.pricing": "Preise",
  },
  it: {
    "reptiles.title": "I miei rettili",
    "reptiles.subtitle": "Trova tutti i tuoi rettili e i loro dettagli.",
    "reptiles.search": "Cerca un rettile",
    "feed.title": "Scorte di cibo",
    "feed.subtitle": "Regola rapidamente le quantita e segui lo storico.",
    "feed.actions": "Azioni rapide",
    "feed.forecast": "Previsione scorte (30 giorni)",
    "feed.history": "Storico",
    "common.add": "Aggiungi",
    "common.remove": "Rimuovi",
    "common.delete": "Elimina",
    "common.health": "Salute",
    "common.last_feed": "Ultimo pasto",
    "home.welcome": "Ciao!",
    "home.subtitle": "Benvenuto nella tua dashboard.",
    "home.reptiles": "Rettili",
    "home.events": "Eventi di oggi",
    "home.notifications": "Notifiche non lette",
    "home.alerts": "Allerte salute",
    "settings.title": "Impostazioni",
    "settings.language": "Lingua dell'app",
    "settings.about": "Informazioni",
    "settings.help": "Aiuto / Supporto",
    "settings.pricing": "Prezzi",
  },
  pt: {
    "reptiles.title": "Meus repteis",
    "reptiles.subtitle": "Encontre todos os seus repteis e seus detalhes.",
    "reptiles.search": "Buscar um reptil",
    "feed.title": "Estoque de alimentos",
    "feed.subtitle": "Ajuste rapidamente as quantidades e acompanhe o historico.",
    "feed.actions": "Acoes rapidas",
    "feed.forecast": "Previsao de estoque (30 dias)",
    "feed.history": "Historico",
    "common.add": "Adicionar",
    "common.remove": "Retirar",
    "common.delete": "Excluir",
    "common.health": "Saude",
    "common.last_feed": "Ultima alimentacao",
    "home.welcome": "Ola!",
    "home.subtitle": "Bem-vindo ao seu painel.",
    "home.reptiles": "Repteis",
    "home.events": "Eventos de hoje",
    "home.notifications": "Notificacoes nao lidas",
    "home.alerts": "Alertas de saude",
    "settings.title": "Configuracoes",
    "settings.language": "Idioma do app",
    "settings.about": "Sobre",
    "settings.help": "Ajuda / Suporte",
    "settings.pricing": "Precos",
  },
  nl: {
    "reptiles.title": "Mijn reptielen",
    "reptiles.subtitle": "Vind al je reptielen en hun details.",
    "reptiles.search": "Zoek een reptiel",
    "feed.title": "Voedselvoorraad",
    "feed.subtitle": "Pas hoeveelheden snel aan en volg de historie.",
    "feed.actions": "Snelle acties",
    "feed.forecast": "Voorraadprognose (30 dagen)",
    "feed.history": "Historie",
    "common.add": "Toevoegen",
    "common.remove": "Verwijderen",
    "common.delete": "Verwijderen",
    "common.health": "Gezondheid",
    "common.last_feed": "Laatste voeding",
    "home.welcome": "Hallo!",
    "home.subtitle": "Welkom op je dashboard.",
    "home.reptiles": "Reptielen",
    "home.events": "Evenementen van vandaag",
    "home.notifications": "Ongelezen meldingen",
    "home.alerts": "Gezondheidswaarschuwingen",
    "settings.title": "Instellingen",
    "settings.language": "App-taal",
    "settings.about": "Over",
    "settings.help": "Hulp / Support",
    "settings.pricing": "Prijzen",
  },
};

type I18nContextValue = {
  locale: SupportedLocale;
  t: (key: string, params?: Record<string, string | number>) => string;
  setLocale: (next: SupportedLocale) => void;
};

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

const translate = (
  locale: SupportedLocale,
  key: string,
  params?: Record<string, string | number>,
): string => {
  const dictionary = translations[locale] ?? translations[FALLBACK_LOCALE];
  const fallback = translations[FALLBACK_LOCALE];
  const value = dictionary[key] ?? fallback[key];
  if (!value) return key;
  if (typeof value === "function") {
    return value(params);
  }
  if (!params) return value;
  return Object.keys(params).reduce((acc, token) => {
    return acc.replace(new RegExp(`\\{${token}\\}`, "g"), String(params[token]));
  }, value);
};

export function getLanguageLabel(locale: SupportedLocale) {
  return LANGUAGE_LABELS[locale] ?? locale.toUpperCase();
}

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [locale, setLocaleState] = useState<SupportedLocale>(FALLBACK_LOCALE);

  useEffect(() => {
    AsyncStorage.getItem(STORAGE_KEY)
      .then((stored) => {
        if (stored && LANGUAGE_ORDER.includes(stored as SupportedLocale)) {
          setLocaleState(stored as SupportedLocale);
        }
      })
      .catch(() => {
        setLocaleState(FALLBACK_LOCALE);
      });
  }, []);

  const setLocale = useCallback((next: SupportedLocale) => {
    setLocaleState(next);
    AsyncStorage.setItem(STORAGE_KEY, next).catch(() => {});
  }, []);

  const t = useCallback(
    (key: string, params?: Record<string, string | number>) =>
      translate(locale, key, params),
    [locale],
  );

  const value = useMemo(
    () => ({
      locale,
      t,
      setLocale,
    }),
    [locale, t, setLocale],
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) {
    throw new Error("useI18n must be used within I18nProvider");
  }
  return ctx;
}

export function getSupportedLocales(): SupportedLocale[] {
  return LANGUAGE_ORDER;
}
